<!DOCTYPE html>
<html>
<head>
	<script src="build/snap.svg-min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Gentium+Basic:400italic' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="styles.css">
	<title>Award-Winning Human</title>
</head>
<body>
	<div class = "imgHolder">
		<!-- <img src="hoverman.svg" alt="Hovering Mystery Man"> -->
		<svg class="arcBg svgPositioning" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="100%" viewBox="0 0 800 800"></svg>
		<img src="hoverman.svg" alt="Hovering Mystery Man" class = "svgPositioning">
		<svg class="pieFace svgPositioning" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="100%" viewBox="0 0 800 800"></svg>
		<svg class="barChart svgPositioning" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="100%" viewBox="0 0 800 800"></svg>
	</div>

	<div class = "theText">
		<p>Award-winning human Jess Peter is zenning out for a bit and hasn't finished her website.</p>
		<p>Contact her at jess@awardwinninghuman.com.</p>
	</div>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script>

	// pie stuff
	var pieSlices = 7;
	var pieData = [];
	pieData = genData(pieSlices);
	var pieRadius = 100;
	var pieColor = [];
	pieColor = genGreys(pieSlices, 100, 255);

	var pie = d3.layout.pie()
    .value(function(d) { return d; })
    .sort(null);

	var pieArc = d3.svg.arc()
    .innerRadius(0)
    .outerRadius(pieRadius);


	var pieSvg = d3.selectAll(".pieFace").append("svg").attr("width", 800).attr("height", 800);

	  var path = pieSvg.datum(pieData).selectAll("path")
      .data(pie);

      path
    .enter().append("path")
      .attr("fill", function(d, i) {
       return d3.rgb(pieColor[i], pieColor[i], pieColor[i]); 
   })
      .attr("stroke", "#000")
      .attr("stroke-width", 2.5)
      .attr("d", pieArc)
      .attr("transform", "translate(400,120)")
      .each(function(d) { this._current = d; });

	//arc stuff
	var arcSvg = d3.selectAll(".arcBg");
	var numArcs = 75;
	var arcData = [];
	arcData = genData(numArcs);
	var colorForArcs = genGreys(numArcs, 0, 150);

	var arcScale = d3.scale.linear()
					.domain([0.01,0.99])
					.range([250,500]);

	var pi = Math.PI;
  	var numSecs = 360/numArcs;

  	var subArc = d3.svg.arc()
  	.innerRadius(0)
  	.outerRadius(function(d){
  		return arcScale(d);
  	})
  	.startAngle(function(d, i){
  		 return i*numSecs * (pi/180);
  	})
  	.endAngle(function(d, i){
  		return (i+1)*numSecs * (pi/180); 
  	});

  	var subArcPath = arcSvg.selectAll(".subArcPath")
			  .data(arcData, function(d, i){
			  	return i;
			  });

	subArcPath.enter()
	.append("path")
	.attr("class","subArcPath")
	.attr("fill", function(d, i){
		return d3.rgb(colorForArcs[i], colorForArcs[i], colorForArcs[i]); 
	})
	.attr("d", subArc)
	.attr("stroke", "#000")
	.attr("stroke-width", 1)
	.attr("transform", "translate(400,450)");

	//bar stuff
	var barNum = 5;
	var barData = [];
	barData = genData(barNum);

	var barSvg = d3.selectAll(".barChart").append("svg").attr("width", 800).attr("height", 800);

	var bars = barSvg.selectAll(".rects")
					.data(barData, function(d, i){ return i});

					bars
					.enter()
					.append("rect")
					.attr("class", "rects")
					.attr("x", function(d, i){
						return i * 10 + 100;
					})
					.attr("y", function(d){
						return 535 - (d * 50);
					})
					.attr("fill", "#fff")
					.attr("stroke", "#000")
					.attr("width", 5)
					.attr("height", function(d){
						return d * 50;
					});

	var fakeAxis = barSvg.append("rect")
					.attr("width", 50)
					.attr("height", 3)
					.attr("y", 550)
					.attr("x", 98)
					.attr("fill", "#fff")
					.attr("stroke", "#000");

	animatePie();
	animateArcs();
	animateBars();


	function animatePie() {
	pieData = genData(pieSlices);
	path = pieSvg.datum(pieData).selectAll("path")
      .data(pie);

    path
    .transition().duration(1000)
      .attrTween("d", arcTween)
      .attr("transform", "translate(400,120)")
      .delay(500)
     	.call(endall, function(){
			animatePie();
		});
	}

	function animateArcs() {
		arcData = genData(numArcs);
		subArcPath = arcSvg.selectAll(".subArcPath")
			  .data(arcData, function(d, i){
			  	return i;
			  });

		subArcPath.transition()
		.duration(1250)
		.attr("d", subArc)
		.call(endall, function(){
			animateArcs();
		});

	}

	function animateBars() {
		barData = genData(barNum);

		bars.data(barData, function(d, i){ return i;});

		bars.transition()
		.duration(1000)
		.attr("y", function(d){
						return 535 - (d * 50);
					})
		.attr("height", function(d){
						return d * 50;
					})
		.call(endall, function(){
			animateBars();
		});




	}

	//from http://stackoverflow.com/questions/10692100/invoke-a-callback-at-the-end-of-a-transition
function endall(transition, callback) { 
    var n = 0; 
    transition 
        .each(function() { ++n; }) 
        .each("end", function() { if (!--n) callback.apply(this, arguments); }); 
  } 


  function arcTween(a) {
  var i = d3.interpolate(this._current, a);
  this._current = i(0);
  return function(t) {
    return pieArc(i(t));
  };
}





function genData(numVals){
		var tempArray = [];
		for (var i = 0; i < numVals; i++){
			tempArray.push(Math.random());
		}
		return tempArray;
	}

function genGreys(numVals, min, max){
		var tempArray = [];
		for (var i = 0; i < numVals; i++){
			tempArray.push(Math.floor(Math.random()* (max - min + 1)) + min);
		}
		return tempArray;
	}




	</script>
</body>
</html>